var E=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var F=(f,e)=>{for(var t in e)E(f,t,{get:e[t],enumerable:!0})},G=(f,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of M(e))!V.call(f,o)&&o!==t&&E(f,o,{get:()=>e[o],enumerable:!(s=D(e,o))||s.enumerable});return f};var w=f=>G(E({},"__esModule",{value:!0}),f);var Z={};F(Z,{default:()=>N});module.exports=w(Z);var j="default";var u={start:"esConnected",stop:"esDisconnected",connected:"esReady",hierarchy:"esDOM",element:"esElement",webcomponents:"esComponents",attributes:"esAttributes",listeners:{value:"esListeners",branch:"esBranch",bind:"esBind",trigger:"esTrigger",format:"esFormat"},trigger:"esTrigger",compose:"esCompose",uri:"esURI",reference:"esReference",childPosition:"esChildPosition",attribute:"__isescomponent",parent:"esParent",component:"esComponent",source:"esSource",path:"__isESComponent",animate:"esAnimate",options:"__esOptions",states:"__esStates",promise:"__esComponentPromise",proxy:"__esProxy",editor:"esCode",flow:"__esManager",original:"esOriginal",resize:"esOnResize"};var C=Symbol("listenerObject"),A=Symbol("toSet"),q=f=>u.listeners.format in f||u.listeners.branch in f||u.listeners.trigger in f||u.listeners.bind in f,L="INITIALIZED",R="REGISTERED",B={},W={},U={},S=Symbol("subscriptionKey"),$=Symbol("configKey"),k=Symbol("toResolveWithKey"),I=class{constructor(e={},t,s){this.original={};this.active={};this.globals={};this.context={};this.rootPath="";this.status="";this.#e=[];this.#s=[];this.getManager=(e="from")=>{let t=e==="to"?this.globals.to:this.globals.from;return this.rootPath.split(this.context.options.keySeparator).forEach(s=>{t[s]||(t[s]={}),t=t[s]}),t[k]??this};this.onStart=e=>{let t=this.#o;t===this?this.status===L?e():this.#s.push(e):t.onStart(e)};this.runEachListener=(e,t)=>{if(!!t)for(let s in e){let o=e[s];if(!o){console.warn("Skipping empty listener:",s);continue}if(o&&typeof o=="object")for(let i in o)t(i,s,o[i]);else typeof s=="string"?t(o,s,s):console.error("Improperly Formatted Listener",s)}};this.register=(e=this.original)=>{this.runEachListener(e,this.add),this.status=R};this.#n=e=>{let t=this.context.monitor.get(e.path,"info");if(typeof t.value=="function"){let s=Array.isArray(e.args)?e.args:[e.args];t.value(...s)}else console.error("Cannot yet trigger values...",e)};this.initialize=e=>{this.status?this.status===R?(this.status=L,this.#e.forEach(this.#n),this.#s.forEach(t=>t()),this.#s=[],this.#e=[]):this.#n(e):this.#e.push(e)};this.start=()=>{this.register(),this.initialize()};this.#i=e=>!e||!this.rootPath||e.includes(this.rootPath)?e:[this.rootPath,e].join(this.context.monitor.options.keySeparator);this.#t=e=>{let t={absolute:{},relative:{}};e=this.#i(e);let s=this.rootPath?e.replace(`${this.rootPath}.`,""):e,o=e.split(this.context.options.keySeparator);return t.absolute.array=[this.context.id,...o],t.relative.array=s.split(this.context.options.keySeparator),this.context.monitor.get(t.relative.array,void 0,this.context.instance)?.hasOwnProperty(u.path)&&(t.absolute.array.push(j),t.relative.array.push(j)),t.absolute.value=t.absolute.array.slice(1).join(this.context.options.keySeparator),t.relative.value=t.relative.array.join(this.context.options.keySeparator),t};this.add=(e,t,s=!0,o)=>{let i=this.#t(e),n=this.#t(t),b=i.absolute.value;o||(o=this.globals.active[b]?.[S]),o||(o=this.context.monitor.on(i.absolute.array,(a,y,P)=>this.activate(a,P),{ref:this.context.instance,path:i.relative.array}));let p={value:s,[C]:!0};[this.active,this.globals.active].forEach(a=>{a[b]||(a[b]={});let y=a[b];y[S]||Object.defineProperty(y,S,{value:o,configurable:!0}),y[n.absolute.value]=p});let r=s[u.listeners.trigger];return r&&this.#o.initialize({path:i.absolute.array,args:r}),this.addToGlobalLog(b),p};this.addToGlobalLog=(e,t="from")=>{let s=this.#i(e),o=t==="to"?this.globals.to:this.globals.from;s.split(this.context.options.keySeparator).forEach(n=>{o[n]||(o[n]={}),o=o[n],o[k]||(o[k]=this)})};this.remove=(e,t)=>{let s=this.#t(e),o=this.#t(t),i=[s.absolute.value,o.absolute.value];[{ref:this.active,path:i},{ref:this.globals.active,path:i,unlisten:!0}].forEach(b=>{let{ref:p,path:v,unlisten:r}=b,a=p[v[0]];if(typeof a=="object"){if(delete a[v[1]],Object.keys(a).length===0){delete p[v[0]];let y=a[S];r&&y&&this.context.monitor.remove(y),delete a[S]}}else delete p[v[0]]})};this.clear=e=>{let t=this.#i(e);Object.keys(this.active).forEach(s=>{Object.keys(this.active[s]).forEach(o=>{(!t||s.slice(0,t.length)===t||o.slice(0,t.length)===t)&&this.remove(s,o)})})};this.has=(e,t=this.active)=>!!t[e];this.get=(e,t=this.active)=>t[e];this.activate=(e,t)=>{[{info:this.get(e,this.globals.active),name}].forEach(o=>{let i=o.info;if(i)if(i[C])this.pass(e,{value:i.value,parent:this.active,key:o.name,subscription:i.subscription,__value:!0},t);else if(typeof i=="object")for(let n in i)this.pass(e,{parent:i,key:n,subscription:i[n].subscription,value:i[n].value},t);else console.error("Improperly Formatted Listener",i)})};this.pass=(e,t,s)=>{let o=this.context.id,i,n,b,p=t?.__value;i=t.parent,n=t.key,b=t.subscription;let v=t.parent[n];t=v.value;let r=v?.[$],a=t,y=typeof t,P=(l,c)=>{let h=this.context.monitor.get(l,"info");if(h.exists){let g=h.value,d={value:typeof g!="function"&&!g?.default?A:g};return c&&(t=d.value,i[n]=d),d}else return{value:void 0}},O=l=>{let c=[o];return c.push(...n.split(this.context.options.keySeparator)),P(c,l)},K=l=>{let c=[o],h=[];return this.rootPath&&h.push(...this.rootPath.split(this.context.options.keySeparator)),h.push(...l.split(this.context.options.keySeparator)),c.push(...h),c};if(typeof t=="boolean")p?console.error(`Cannot use a boolean for ${u.listeners.value}...`):O(!0);else if(y==="string"){let l=K(a);P(l,!0),p&&(i[n]={[a]:i[n]},n=a)}else t&&y==="object"&&q(a)&&("value"in a?p?t=i[n]=a.value:t=i[n].value=a.value:O(!0),a&&a&&(r=a),Object.defineProperty(i[n],$,{value:r}));let _=!0;if(r){let l=u.listeners.value;if(l in r){let c=K(r[l].original??r[l]);if(typeof r[l]=="string"){let h=this.context.monitor.get(c);h?r[l]={value:h,original:r[l]}:t=`because ${c.slice(1).join(this.context.options.keySeparator)} does not point correctly to an existing component.`}else r[l].value.esParent||(t=`because ${r[l].original??o.toString()} has become unparented.`)}else{let c=u.listeners.branch,h=u.listeners.format;if(c in r&&(r[c].find(m=>{let x=[];"condition"in m&&x.push(m.condition(s)),"equals"in m&&x.push(m.equals===s);let d=x.length>0&&x.reduce((T,z)=>T&&z,!0);return d&&"value"in m&&(s=m.value),d})||(_=!1)),h in r)try{s=r[h](s),s===void 0&&(_=!1)}catch(g){console.error("Failed to format arguments",g)}}}if(_&&s!==void 0){let l=Array.isArray(s)?s:[s];if(t===A){let c=[o];c.push(...n.split(this.context.options.keySeparator));let h=c.pop(),g=this.context.monitor.get(c,"info");g.value[h]=s}else if(t?.default)t.default.call(t,...l);else if(typeof t=="function")i[n][C]?t.call(r?.[u.listeners.bind]?.value??this.context.instance,...l):t(...l);else{let c=n?`listener: ${e} \u2014> ${n}`:`listener from ${e}`;i?(console.warn(`Deleting ${c}`,t),delete i[n]):console.error(`Failed to add ${c}`,t)}}};this.context=s,this.rootPath=t,this.original=e,[{name:"active",ref:U},{name:"from",ref:B},{name:"to",ref:W}].forEach(i=>{i.ref[this.context.id]||(i.ref[this.context.id]={}),this.globals[i.name]=i.ref[this.context.id]}),this.#o=this.getManager(),this.runEachListener(e,this.addToGlobalLog)}#e;#s;#o;#n;#i;#t},N=I;0&&(module.exports={});
//# sourceMappingURL=index.node.js.map
