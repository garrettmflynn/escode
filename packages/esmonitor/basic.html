<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
<script type="module">
    import Monitor from './dist/index.esm.js'

const monitor = new Monitor()

// ---------------- Register Object ----------------
const id = 'actor'
const add = async (input) => input + 1
const subtract = (input) => input - 1
const actor = { nested: { add } }

const storeId = 'store'
const store = { value: 0 }

monitor.set(id, actor, {static: false})
monitor.set(storeId, store, {static: false})


// ---------------- Create Listeners for the Entire Object ----------------
const functionPath = ['nested', 'add']

const storeSubs = monitor.on(storeId, (path, info, output) => {
    console.log(`Updated Store (${path}) - ${output}`, info)
})

// ---------------- Selectively Listen to Object Property ----------------
const funcSubs = monitor.on([id, ...functionPath], (path, info, output) => {
    console.log(`Update from Function (${path}) - ${output}`, info)
    store.value = output // set store value
    store.updated = true
})

// // ---------------- Proposed Configuration ----------------
// const storeSubs = monitor.on(storeId, {
//     func1: (path, info, output) => console.log(`Updated Store (${path}) - ${output}`, info),
//     __branch: [
//         {is: 1, value: () => console.log(`Is One!`)},
//         {is: 2, value: () => console.log(`Is Two!`)},
//         {is: true, value: () => console.log(`Is True!`)},
//     ],
//     __format: (...args) => {
//         console.log('Formatting!', args)
//         return args
//     }
// })

// const valueSubs = monitor.on([storeId, value], {
//     update: [storeId, update], // Trigger update with name
//     secondUpdate: true // Trigger update with boolean
// })


let expected = 0

expected = store.value = 1
expected++
await actor.nested.add(store.value)

monitor.remove(storeSubs) // Clear test subscriptions only

const set = store.value + 1
expected++
store.value = set // No response
expected++
await actor.nested.add(store.value) // Received

console.log('Value', store.value)
console.log('Expected', expected)

monitor.remove() // Remove all subscriptions
</script>
</html>